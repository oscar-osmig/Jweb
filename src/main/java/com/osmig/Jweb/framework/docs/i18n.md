# Internationalization (i18n)

JWeb provides i18n support for building multilingual applications.

## Basic Usage

```java
import com.osmig.Jweb.framework.i18n.I18n;
import com.osmig.Jweb.framework.i18n.Messages;

// Get translated message
String title = I18n.t("page.title");

// With parameters
String greeting = I18n.t("welcome", username);
// "welcome" = "Hello, {0}!" → "Hello, John!"
```

## Setting Up Messages

Create message files in `src/main/resources/messages/`:

**messages_en.properties:**
```properties
page.title=Welcome
page.description=This is our application
nav.home=Home
nav.about=About
nav.contact=Contact
welcome=Hello, {0}!
errors.required=This field is required
errors.email=Please enter a valid email
```

**messages_es.properties:**
```properties
page.title=Bienvenido
page.description=Esta es nuestra aplicación
nav.home=Inicio
nav.about=Acerca de
nav.contact=Contacto
welcome=¡Hola, {0}!
errors.required=Este campo es obligatorio
errors.email=Por favor ingrese un email válido
```

## Locale Detection

I18n detects the user's locale from (in order):

1. Query parameter: `?lang=es`
2. Session attribute: `lang`
3. Cookie: `lang`
4. Accept-Language header
5. Default locale

```java
app.get("/", req -> {
    Locale locale = I18n.getLocale(req);
    String title = Messages.get(locale, "page.title");
    return new HomePage(title);
});
```

## I18n Middleware

Automatically set locale for each request:

```java
app.use(I18n.middleware());

// Now I18n.current() works anywhere
app.get("/", req -> {
    String title = I18n.t("page.title");  // Uses current locale
    return new HomePage(title);
});
```

## Using in Templates

```java
public class HomePage implements Template {
    @Override
    public Element render() {
        return div(
            h1(I18n.t("page.title")),
            p(I18n.t("page.description")),
            nav(
                a(href("/"), I18n.t("nav.home")),
                a(href("/about"), I18n.t("nav.about")),
                a(href("/contact"), I18n.t("nav.contact"))
            )
        );
    }
}
```

## Message Parameters

```java
// Single parameter
I18n.t("welcome", "John");  // "Hello, John!"

// Multiple parameters
I18n.t("order.summary", orderId, itemCount, total);
// "order.summary" = "Order #{0}: {1} items, total ${2}"
// → "Order #123: 5 items, total $49.99"
```

## Request-Specific Locale

```java
app.get("/", req -> {
    // Get locale for this specific request
    String title = I18n.t(req, "page.title");
    return new HomePage(title);
});
```

## Language Picker

Get list of supported locales for a language picker:

```java
app.get("/settings", req -> {
    List<I18n.LocaleInfo> locales = I18n.getSupportedLocales();
    // Each has: code, nativeName, englishName
    // e.g., {code: "es", nativeName: "Español", englishName: "Spanish"}

    return new SettingsPage(locales);
});
```

```java
// In template
ul(class_("language-picker"),
    each(locales, locale ->
        li(
            a(href("?lang=" + locale.code()),
                locale.nativeName()  // Shows "Español" for Spanish
            )
        )
    )
)
```

## Changing Locale

### Via Query Parameter

```
/page?lang=es
```

### Via Session

```java
app.post("/language", req -> {
    String lang = req.formParam("lang");
    req.session().setAttribute("lang", lang);
    return Response.redirect(req.header("Referer"));
});
```

### Via Cookie

```java
app.post("/language", req -> {
    String lang = req.formParam("lang");
    Cookie.of("lang", lang)
        .maxAge(Duration.ofDays(365))
        .addTo(response);
    return Response.redirect("/");
});
```

## Default Locale

Set the default locale:

```java
Messages.setDefaultLocale(Locale.ENGLISH);
```

## Available Locales

Register available locales:

```java
Messages.setAvailableLocales("en", "es", "fr", "de");
```

## Parsing Accept-Language

```java
String header = "en-US,en;q=0.9,es;q=0.8";
Locale locale = I18n.parseAcceptLanguage(header);
// Returns Locale.US or first matching supported locale
```

## Complete Example

```java
@Component
public class Routes implements JWebRoutes {
    @Override
    public void configure(JWeb app) {
        // Add i18n middleware
        app.use(I18n.middleware());

        // Pages use I18n.t() for translations
        app.get("/", req -> new HomePage());
        app.get("/about", req -> new AboutPage());

        // Language switch
        app.post("/language", req -> {
            String lang = req.formParam("lang");
            req.session().setAttribute("lang", lang);

            String referer = req.header("Referer");
            return Response.redirect(referer != null ? referer : "/");
        });
    }
}

public class Layout implements Template {
    private final Element content;

    public Layout(Element content) {
        this.content = content;
    }

    @Override
    public Element render() {
        return html(lang(I18n.current().getLanguage()),
            head(
                title(I18n.t("page.title"))
            ),
            body(
                header(
                    nav(
                        a(href("/"), I18n.t("nav.home")),
                        a(href("/about"), I18n.t("nav.about"))
                    ),
                    languagePicker()
                ),
                main(content)
            )
        );
    }

    private Element languagePicker() {
        return form(method("post"), action("/language"),
            select(name("lang"), onChange("this.form.submit()"),
                each(I18n.getSupportedLocales(), locale ->
                    option(
                        value(locale.code()),
                        selected(locale.code().equals(I18n.current().getLanguage())),
                        text(locale.nativeName())
                    )
                )
            )
        );
    }
}
```
